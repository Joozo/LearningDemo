$(document).ready(function(){$("#BrandSysNoSelect option"),$("#OriginCodeSelect option");BasicInfo.InitEditor();var t,e;$("#BasicInfoForm").bootstrapValidator({message:"输入值无效！",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{ProductName:{validators:{notEmpty:{message:"请输入商品名称！"},regexp:{regexp:/^[^<>（）《》？｛｝：&ＱＷＥＲＴＹＵＩＯＰＡＳＤＦＧＨＪＫＬＺＸＣＶＢＮＭｑｗｅｒｔｙｕｉｏｐａｓｄｆｇｈｊｋｌｚｘｃｖｂｎｍ１２３４５６７８９０！＠＃￥％＆－＝＋$＾＊　　#%&'+]+$/,message:"商品名称不能包含HTML标签和全角字符！"}}},BriefName:{validators:{notEmpty:{message:"请输入商品简称！"},regexp:{regexp:/^[^<>（）《》？｛｝：&ＱＷＥＲＴＹＵＩＯＰＡＳＤＦＧＨＪＫＬＺＸＣＶＢＮＭｑｗｅｒｔｙｕｉｏｐａｓｄｆｇｈｊｋｌｚｘｃｖｂｎｍ１２３４５６７８９０！＠＃￥％＆－＝＋$＾＊　　#%&'+]+$/,message:"商品简称不能包含HTML标签和全角字符！"}}},Keywords:{validators:{regexp:{regexp:/^[^<>（）《》？｛｝：&ＱＷＥＲＴＹＵＩＯＰＡＳＤＦＧＨＪＫＬＺＸＣＶＢＮＭｑｗｅｒｔｙｕｉｏｐａｓｄｆｇｈｊｋｌｚｘｃｖｂｎｍ１２３４５６７８９０！＠＃￥％＆－＝＋$＾＊　　#%&'+]+$/,message:"关键字不能包含HTML标签和全角字符！"}}},BrandSysNo:{validators:{notEmpty:{message:"请选择品牌！"}}}}}).on("success.form.bv",function(e){t=!0}),$("#DescriptionForm").bootstrapValidator({message:"输入值无效！",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{ProductDesc:{validators:{notEmpty:{message:"请输入商品简述！"}}}}}).on("success.form.bv",function(t){e=!0}),$("#SaveInfo").click(function(){t=!1,e=!1,$("#BasicInfoForm").bootstrapValidator("validate"),$("#DescriptionForm").bootstrapValidator("validate"),t&&e&&BasicInfo.Save()}),$("#StoreSysNo").on("change",function(){$("#StoreSysNo").val()>0?$.post("/ProductMaintain/FrontProductCategorySelector",{SelectedStoreSysNo:$("#StoreSysNo").val(),ID:"NewFrontCategorySysNo",DataModel:""},function(t){$(".front_category").html(t)}):($(".front_category").html('<select class="bs-select form-control selectpicker" id="NewFrontCategorySysNo" name="NewFrontCategorySysNo" disabled><option>'+JR("--请选择--")+"</option></select>"),$("#SwitchProductToAnotherStore").addAttr("disabled","disabled"))}),$("#NewFrontCategorySysNo").live("change",function(){$("#NewFrontCategorySysNo").val()>0?$("#SwitchProductToAnotherStore").removeAttr("disabled"):$("#SwitchProductToAnotherStore").addAttr("disabled","disabled")}),$("#SwitchProductToAnotherStore").on("click",function(){BasicInfo.ProductSwitch()}),$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"}),$(".select2").select2({placeholder:"Select an option",allowClear:!0})});var BasicInfo={ProductGroupSysNo:0,ProductDescLongEditor:null,ProductPhotoDescEditor:null,InitEditor:function(){UEDITOR_CONFIG.zIndex=1,BasicInfo.ProductDescLongEditor=new UE.ui.Editor,BasicInfo.ProductPhotoDescEditor=new UE.ui.Editor,BasicInfo.ProductDescLongEditor.render("ProductDescLongEditor"),BasicInfo.ProductPhotoDescEditor.render("ProductPhotoDescEditor")},Save:function(){var t=$.buildEntity($("#BasicInfoForm")),e=$.buildEntity($("#DescriptionForm"));return $.extend(t,e),t.ProductPhotoDesc=BasicInfo.ProductPhotoDescEditor.getContent(),t.ProductDescLong=BasicInfo.ProductDescLongEditor.getContent(),0==$.trim(t.FrontCategorySysNo).length||parseInt(t.FrontCategorySysNo)<=0?void $.alert("请选择店铺类别！"):0==$.trim(t.BrandSysNo).length||parseInt(t.BrandSysNo)<=0?void $.alert(JR("请选择品牌！")):0==$.trim(t.OriginCode).length?void $.alert(JR("请选择产地！")):void bootbox.dialog({message:'<input type="checkbox" id="cbk" style="vertical-align:text-top;margin-top:0px;margin-right:2px;"/><label for="cbk">我已阅读并同意<a href="/Content/商户承诺书.docx">《商户承诺书》</a></label>',title:JR("您确定要保存？"),buttons:{Cancel:{label:JR("取消"),className:"btn-default"},OK:{label:JR("确认"),className:"btn-primary",callback:function(){var e=$("#cbk").prop("checked");if(!e)return $.alert(JR("您必须先同意《商户承诺书》")),!1;BasicInfo.ProductGroupSysNo>0&&(t.ProductGroupSysNo=BasicInfo.ProductGroupSysNo);var o=[];$("select[Property=Normal]").each(function(){o.push({PropertyGroupSysNo:$(this).attr("GroupSysNo"),PropertyGroupName:$(this).attr("GroupName"),PropertySysNo:$(this).attr("PropertySysNo"),PropertyName:$(this).attr("PropertyName"),ValueDescription:$.trim($(this).find("option:selected").text()),IsSplitGroupProperty:$(this).attr("IsSplitGroup"),PropertyValueSysNo:$(this).val()})}),t.SelectNormalProperties=o,$.ajax({url:"AjaxSaveProductBasicInfo",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(t))},beforeSend:function(t){$.showLoading()},success:function(t){t.message?$.alert(t.message):$.alert(JR("保存商品信息成功！"),function(){location.href="BasicInfo?ProductGroupSysNo="+t})},complete:function(t,e){$.hideLoading()}})}}}})},ProductSwitch:function(){var t=$.buildEntity($("#BasicInfoForm")),e=$.buildEntity($("#DescriptionForm"));return $.extend(t,e),t.FrontCategorySysNo=$("#NewFrontCategorySysNo").val(),t.StoreSysNo=$("#StoreSysNo").val(),0==$.trim(t.FrontCategorySysNo).length||parseInt(t.FrontCategorySysNo)<=0?void(isSwitchProductToAnotherStore?$.alert(JR("请选择迁移目标店铺的店铺类别！")):$.alert(JR("请选择店铺类别！"))):void $.confirm(JR("您确定要保存？"),function(e){e&&(BasicInfo.ProductGroupSysNo>0&&(t.ProductGroupSysNo=BasicInfo.ProductGroupSysNo),$.post("/productmaintain/ProductSwitch",{data:encodeURI(JSON.stringify(t))},function(t){t.error||("Failure"!=t.result?$.alert(JR("商品迁移成功！"),function(){location.href="/Product/Query"}):$.alert(t.message))}))})}};!function(t){t.fn.bootstrapValidator.i18n.limitApplyQty=t.extend(t.fn.bootstrapValidator.i18n.limitApplyQty||{},{"default":"Please enter right length"}),t.fn.bootstrapValidator.validators.limitApplyQty={validate:function(e,o,a){var n=t("#ApplyUnit").val().trim(),r=o.val().trim();return"千克"!=n&&1!=r?!1:!0}}}(window.jQuery),$(document).ready(function(){$(".date-picker").datepicker({rtl:Metronic.isRTL(),orientation:"left",autoclose:!0,language:"zh-CN"}),$("#ApplyUnit").change(function(){"千克"!=$("#ApplyUnit").val()&&$("#ApplyQty").attr("value","1"),"千克"==$("#ApplyUnit").val()&&$("#MaintainEntryForm").data("bootstrapValidator").updateStatus("ApplyQty","NOT_VALIDATED",null).validateField("ApplyQty")}),$("#MaintainEntryForm").bootstrapValidator({message:"输入值无效！",exclude:[],feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{Specifications:{validators:{notEmpty:{message:"请输入规格！"}}},ProductNameEN:{validators:{notEmpty:{message:"请输入英文名称！"}}},Functions:{validators:{notEmpty:{message:"请输入功能！"}}},Component:{validators:{notEmpty:{message:"请输入成份！"}}},Purpose:{validators:{notEmpty:{message:"请输入用途！"}}},selIsFood:{validators:{notEmpty:{message:"请选择商品类别！"}}},ApplyDistrict:{validators:{notEmpty:{message:"请选择海关关区！"}}},TaxQty:{validators:{notEmpty:{message:"请输入计税单位数量！"},stringLength:{max:10,message:"计税单位数量最多输入10位！"},regexp:{regexp:/^\d{0,8}\.{0,1}(\d{1,4})?$/,message:"计税单位数量只能输入大于0的整数或者4位小数！"}}},ApplyUnit:{validators:{notEmpty:{message:"请输入申报单位！"},stringLength:{min:1,max:3,message:"申报单位最多输入3位！"},regexp:{regexp:/^[\u4E00-\u9FA5]+$/,message:"申报单位必须使用中文单位！"}}},ApplyQty:{validators:{notEmpty:{message:"请输入申报数量！"},limitApplyQty:{message:"申报单位非千克时申报数量必须为1"},callback:{message:"申报数量只能输入输入大于0的整数或者2位小数！",callback:function(t,e,o){var a=/^\d{0,8}\.{0,1}(\d{1,2})?$/;return parseFloat(t,10)>0&&a.test(t)}}}},TariffRate:{validators:{regexp:{regexp:/^0\.{0,1}(\d{1,2})?$/,message:"税率只能输入0，或者大于0小于1的2位小数！"}}},GrossWeight:{validators:{notEmpty:{message:"请输入毛重！"},callback:{message:"毛重只能输入大于0的整数或者3位小数！",callback:function(t,e,o){var a=/^\d{0,8}\.{0,1}(\d{1,3})?$/;return parseFloat(t)>0&&a.test(t)}}}},SuttleWeight:{validators:{notEmpty:{message:"请输入净重！"},callback:{message:"净重只能输入大于0的整数或者3位小数！",callback:function(t,e,o){var a=/^\d{0,8}\.{0,1}(\d{1,3})?$/;return parseFloat(t)>0&&a.test(t)}}}}}}).on("success.form.bv",function(t){1==EntryInfo.SaveType?EntryInfo.SaveEntryInfo():2==EntryInfo.SaveType&&EntryInfo.SaveAndSubmitAudit()}),$("[data-toggle='tooltip']").tooltip(),$(".EditEntryInfo").click(function(){$("#divDetail").removeClass("hidden"),$("#MaintainEntryForm").data("bootstrapValidator").resetForm(!0),EntryInfo.EditEntryInfo(parseInt($(this).attr("ProductSysNo")))}),$("#SaveEntryInfo").click(function(){EntryInfo.SaveType=1,$("#MaintainEntryForm").bootstrapValidator("validate")}),$("#SubmitEntryInfo").click(function(){EntryInfo.SaveType=2,$("#MaintainEntryForm").bootstrapValidator("validate")}),EntryInfo.InitProductSysNo>0&&EntryInfo.EditEntryInfo(EntryInfo.InitProductSysNo),$("#selIsFood").change(function(t){"食品"===$(this).val()?($("#TaxQty").val("").prop("readonly",!1),$("#TaxUnit").val("千克")):"非食品"===$(this).val()?($("#TaxQty").val("1").prop("readonly",!0),$("#TaxUnit").val("件")):$("#TaxUnit").val("").removeAttr("readonly"),$("#MaintainEntryForm").data("bootstrapValidator").updateStatus("TaxQty","NOT_VALIDATED",null).validateField("TaxQty")}),$("#btnUpload").click(function(){return EntryInfo.InitProductSysNo<=0?void $.alert("请选择商品！"):void $("#entryFileUploader").uploadify("upload")}),$("#tbodyEntryAttachment").on("click","a[data-role='delete']",function(){var t=$(this).attr("fileID");parseInt(t)>0?EntryInfo.DelEntryFile($(this),t):$.alert("请选择要删除的文件！")}),$("#tbodyEntryAttachment").on("click","a[data-role='downloadAttachment']",function(){var t=$(this).attr("fileUrl");window.location="/ProductMaintain/AjaxDownloadProductEntryAttachment?url="+t}),$("#entryFileUploader").uploadify({swf:"/Content/third/uploadify/uploadify.swf",buttonText:"选择资料文件",uploader:EntryInfo.FileServer+"/UploadHandler.ashx?appName=entry",auto:!1,onSelect:function(t){EntryInfo.SelectFileCount+=1,$("#btnUpload").show()},onUploadSuccess:function(t,e,o){var e=JSON.parse(e);"SUCCESS"!=e.state?$.alert(e.message):EntryInfo.SaveFileInfo(e)},onUploadError:function(t,e,o,a){"-280"!=e?$.alert("上传失败请重试。",function(){window.location.reload()}):EntryInfo.SelectFileCount-=1}})});var EntryInfo={FileServer:"",SelectFileCount:0,SaveFileInfo:function(t){var e={ProductSysNo:EntryInfo.InitProductSysNo,Name:t.title,ResourceUrl:t.url,Original:t.original};$.ajax({url:"AjaxSubmitProductEntryAttachment",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(e))},beforeSend:function(t){$.showLoading()},success:function(t){if(!t.message){$("#btnUpload").hide();var o="<tr>                                        <td style='vertical-align: middle;'>"+e.Original+"                                        </td>                                        <td>"+t.ResourceUrl+"</td>                                        <td>                                            <a href='javascript:void(0)' fileID="+t.SysNo+" data-role='delete' class='btn default btn-xs red'>                                                <i class='fa fa-trash-o'></i>删除</a>                                            <a href='"+EntryInfo.FileServer+"/"+t.ResourceUrl+"'  target='_blank'  data-role='downloadAttachment' class='btn default btn-xs green'>                                                <i class='fa fa-download'></i>附件下载</a>                                        </td>                                    </tr>";$("#tbodyEntryAttachment").append(o),EntryInfo.ContinueUpload()}},complete:function(t,e){$.hideLoading()}})},DelEntryFile:function(t,e){$.confirm("确定删除该备案附件？",function(){$.ajax({url:"AjaxDelProductEntryAttachment",type:"POST",dataType:"json",data:{data:e},beforeSend:function(t){$.showLoading()},success:function(e){e.message||t.parents("tr").remove()},complete:function(t,e){$.hideLoading()}})})},ContinueUpload:function(){EntryInfo.SelectFileCount-=1,EntryInfo.SelectFileCount>0?$("#entryFileUploader").uploadify("upload"):$.alert("上传商检备案资料成功！")},InitProductSysNo:0,SaveType:1,EditEntryInfo:function(t){EntryInfo.SaveType=1,$.ajax({url:"AjaxGetProductEntryInfo?sysno="+t,type:"POST",dataType:"json",beforeSend:function(t){$.showLoading()},success:function(e){if(!e.message){null!=e.ManufactureDate&&(e.ManufactureDate=e.ManufactureDate.replace(" 0:00:00","")),e.TaxQty<=0&&(e.TaxQty=1),"千克"===e.TaxUnit||"kg"===e.TaxUnit?(e.selIsFood="食品",$("#TaxQty").prop("readonly",!1)):(e.selIsFood="非食品",e.TaxUnit="件",$("#TaxQty").prop("readonly",!0));var o="";if("0"==e.BizType){for(var a=0;a<oCustomsCodeModel1.length;a++)o+="<option value="+oCustomsCodeModel1[a].key+">"+oCustomsCodeModel1[a].value+"</option>";$("#bizTypeid").hide(),$("#MaintainEntryForm").data("bootstrapValidator").validateField("ApplyUnit"),$("#MaintainEntryForm").data("bootstrapValidator").validateField("ApplyQty")}else if("1"==e.BizType){o+="<option value=''>"+JR("请选择")+"</option>";for(var a=0;a<oCustomsCodeModel2.length;a++)o+="<option value="+oCustomsCodeModel2[a].key+">"+oCustomsCodeModel2[a].value+"</option>";$("#bizTypeid").show()}var n=$("[data-model='ApplyDistrict']");switch(n.html(o),$.bindEntity($("#MaintainEntryForm"),e),n.get(0).selectedIndex<0&&(n.get(0).selectedIndex=0),$("#EntryStatusPanel").html(e.EntryStatusText),-1==e.EntryStatus||0==e.EntryStatus?($("#SaveEntryInfo").show(),$("#SubmitEntryInfo").show()):($("#SaveEntryInfo").hide(),$("#SubmitEntryInfo").hide()),$("#EntryStatusPanel").removeClass("label-info"),$("#EntryStatusPanel").removeClass("label-warning"),$("#EntryStatusPanel").removeClass("label-danger"),$("#EntryStatusPanel").removeClass("label-success"),e.EntryStatus){case-2:$("#EntryStatusPanel").addClass("label-danger");break;case-1:case 0:$("#EntryStatusPanel").addClass("label-warning");break;case 4:$("#EntryStatusPanel").addClass("label-success");break;default:$("#EntryStatusPanel").addClass("label-info")}Metronic.updateUniform(),$.ajax({url:"/Common/AjaxGetEntryAttachmentArea?bizSysNo="+t+"&source=3",type:"GET",dataType:"html",beforeSend:function(t){$.showLoading()},success:function(e){$("#entryAttachmentArea").find(".portlet-body").remove(),$("#entryAttachmentArea").append(e),EntryAttachment.BizSysNo=t,EntryAttachment.Init()}})}},complete:function(t,e){$.hideLoading()}})},SaveEntryInfo:function(){var t=$.buildEntity($("#MaintainEntryForm"));return t.ProductSysNo<=0?($.alert("请选择商品！"),!1):parseFloat(t.GrossWeight)<parseFloat(t.SuttleWeight)?($.alert("毛重必须大于或者等于净重,请修改!"),!1):t.ApplyDistrict&&0!=t.ApplyDistrict?null==t.ApplyQty?($.alert("数据填写不完整：请填写申报数量"),!1):void $.confirm("您确定要保存备案信息吗？",function(e){e&&$.ajax({url:"AjaxSaveEntryInfo",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(t))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("保存备案信息成功！",function(){$("#divDetail").addClass("hidden"),$("#MaintainEntryForm")[0].reset(),$("input[data-model=ProductSysNo]").val(0),$("#MaintainEntryForm").data("bootstrapValidator").resetForm(!0),$("#SaveEntryInfo").hide(),$("#SubmitEntryInfo").hide()})},complete:function(t,e){$.hideLoading()}})}):($.alert("数据填写不完整：请选择海关关区"),!1)},SaveAndSubmitAudit:function(){var t=$.buildEntity($("#MaintainEntryForm"));return t.ProductSysNo<=0?($.alert("请选择商品！"),!1):parseFloat(t.GrossWeight)<parseFloat(t.SuttleWeight)?($.alert("毛重必须大于或者等于净重,请修改!"),!1):t.ApplyDistrict&&0!=t.ApplyDistrict?void $.confirm("您确定要保存并提交备案申请吗？",function(e){e&&$.ajax({url:"AjaxSubmitProductEntryAudit",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(t))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("保存并提交备案申请成功！",function(){$("#divDetail").addClass("hidden"),$("#MaintainEntryForm")[0].reset(),$("input[data-model=ProductSysNo]").val(0),$("#MaintainEntryForm").data("bootstrapValidator").resetForm(!0),$("#SaveEntryInfo").hide(),$("#SubmitEntryInfo").hide(),window.location.reload()})},complete:function(t,e){$.hideLoading()}})}):($.alert("数据填写不完整：请选择海关关区"),!1)}};$(document).ready(function(){$(".date-picker").datepicker({dateFormat:"yyyy-mm-dd",rtl:Metronic.isRTL(),orientation:"left",autoclose:!0,language:"zh-CN"}),$(".date-range").defaultDateRangePicker(),$("#SaveInfo").click(function(){GroupProduct.CreateGroupProduct()})});var GroupProduct={ProductGroupSysNo:0,CreateGroupProduct:function(){var t=[];if($("div[Property=Group]").each(function(){var e=[];$(this).find("input").each(function(){"checked"==$(this).attr("checked")&&e.push({PropertyGroupName:$(this).attr("PropertyGroupName"),PropertySysNo:$(this).attr("PropertySysNo"),PropertyName:$(this).attr("PropertyName"),ValueSysNo:$(this).val(),ValueName:$(this).attr("ValueName")})}),e.length>0&&t.push(e)}),0==t.length)return void $.alert("请选择分组属性！");var e=[];if(1==t.length)for(var o=0;o<t[0].length;o++)e.push({ProductGroupSysNo:GroupProduct.ProductGroupSysNo,PropertyGroupName:t[0][o].PropertyGroupName,PropertySysNo1:t[0][o].PropertySysNo,PropertyName1:t[0][o].PropertyName,ValueSysNo1:t[0][o].ValueSysNo,ValueName1:t[0][o].ValueName,ShipPriceTemplateSysNo:defaultTemplateSysNo});else for(var o=0;o<t[0].length;o++)for(var a=0;a<t[1].length;a++)e.push({ProductGroupSysNo:GroupProduct.ProductGroupSysNo,PropertyGroupName:t[0][o].PropertyGroupName,PropertySysNo1:t[0][o].PropertySysNo,PropertyName1:t[0][o].PropertyName,ValueSysNo1:t[0][o].ValueSysNo,ValueName1:t[0][o].ValueName,PropertySysNo2:t[1][a].PropertySysNo,PropertyName2:t[1][a].PropertyName,ValueSysNo2:t[1][a].ValueSysNo,ValueName2:t[1][a].ValueName,ShipPriceTemplateSysNo:defaultTemplateSysNo});$.ajax({url:"AjaxCreateGroupProduct",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(e))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("保存商品成功！",function(){location.href="GroupProduct?ProductGroupSysNo="+GroupProduct.ProductGroupSysNo})},complete:function(t,e){$.hideLoading()}})},Online:function(t){var e=GroupProduct.GetData(t);GroupProduct.CheckData(e)&&$.confirm("您确定要上架该商品吗？",function(t){t&&$.ajax({url:"/ProductMaintain/AjaxProductBatchOnline",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(e))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("上架商品成功！",function(){location.reload()})},complete:function(t,e){$.hideLoading()}})})},OnlineNotShow:function(t){var e=GroupProduct.GetData(t);GroupProduct.CheckData(e)&&$.confirm("您确定要上架不展示该商品吗？",function(t){t&&$.ajax({url:"/ProductMaintain/AjaxProductBatchOnlineNotShow",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(e))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("上架不展示商品成功！",function(){location.reload()})},complete:function(t,e){$.hideLoading()}})})},Offline:function(t){var e=[];e.push(t),$.confirm("您确定要下架该商品吗？",function(t){t&&$.ajax({url:"/ProductMaintain/AjaxProductBatchOffline",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(e))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("下架商品成功！",function(){location.reload()})},complete:function(t,e){$.hideLoading()}})})},Abandon:function(t){var e=[];e.push(t),$.confirm("您确定要作废该商品吗？",function(t){t&&$.ajax({url:"/ProductMaintain/AjaxProductBatchAbandon",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(e))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("作废商品成功！",function(){location.reload()})},complete:function(t,e){$.hideLoading()}})})},SaveProduct:function(t){var e=GroupProduct.GetData(t);GroupProduct.CheckData(e)&&$.ajax({url:"/ProductMaintain/AjaxSaveSingleProductInfo",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(e))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("保存商品信息成功！",function(){location.reload()})},complete:function(t,e){$.hideLoading()}})},GetData:function(t){var e={ProductSysNo:t,PromotionTitle:$("#PromotionTitle"+t).val(),TimePromotionTitle:$("#TimePromotionTitle"+t).val(),PromotionTitleBeginDate:$("#PromotionTitleBeginDate"+t).val(),PromotionTitleEndDate:$("#PromotionTitleEndDate"+t).val(),ProductMode:$("#ProductMode"+t).val(),Weight:0==$.trim($("#Weight"+t).val()).length?"0":$("#Weight"+t).val(),Length:0==$.trim($("#Length"+t).val()).length?"0":$("#Length"+t).val(),Width:0==$.trim($("#Width"+t).val()).length?"0":$("#Width"+t).val(),Height:0==$.trim($("#Height"+t).val()).length?"0":$("#Height"+t).val(),UPCCode:$("#UPCCode"+t).val(),ProductOutUrl:$("#ProductOutUrl"+t).val(),AlertQtyWeeklySaleCount:$("#AlertQtyWeeklySaleCount"+t).val(),AlertQtyFixNum:$("#AlertQtyFixNum"+t).val(),ShipPriceTemplateSysNo:$("#ShipPriceTemplate"+t).val(),Status:$("#Status"+t).val()};return e},CheckData:function(t){var e=/^[0-9]*$/,o=/^\d{0,8}\.{0,1}(\d{1,2})?$/,a="^(https://|http://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$",n=new RegExp(a);return 0==$.trim(t.ProductMode).length?($.alert("请输入型号！"),!1):0==$.trim(t.UPCCode).length?($.alert("请输入标准条形码, 如没有则填8个0！"),!1):e.test(t.Weight)?parseInt(t.Weight)<=0?($.alert("重量必须输入大于0的整数！"),!1):parseFloat(t.Length)<=0||!o.test(t.Length)?($.alert("长度必须输入大于0的整数或者2位小数！"),!1):parseFloat(t.Width)<=0||!o.test(t.Width)?($.alert("宽度必须输入大于0的整数或者2位小数！"),!1):parseFloat(t.Height)<=0||!o.test(t.Height)?($.alert("高度必须输入大于0的整数或者2位小数！"),!1):$.trim(t.ProductOutUrl).length>0&&!n.test(t.ProductOutUrl)?($.alert("请填写正确的网址，以http://开头！"),!1):e.test(t.AlertQtyWeeklySaleCount)?e.test(t.AlertQtyFixNum)?0==$.trim(t.ShipPriceTemplateSysNo).length||parseInt(t.ShipPriceTemplateSysNo)<=0?($.alert("请选择运费模板！"),!1):!0:($.alert("库存预警下限-固定值,必须输入大于0的整数！"),!1):($.alert("库存预警下限-前M周销售数量,必须输入大于0的整数！"),!1):($.alert("重量必须输入大于0的整数！"),!1)},inputAlterStockQtyCheck:function(t,e){0==t?$("#AlertQtyFixNum"+e.toString()).val(""):1==t&&$("#AlertQtyWeeklySaleCount"+e.toString()).val("")}};$(document).ready(function(){$("#coverFileUploader").uploadify({swf:"/Content/third/uploadify/uploadify.swf",buttonText:"选择商品图片",uploader:ImageInfo.ImageServer+"/UploadHandler.ashx?appName=product&watermarkPic="+ImageInfo.LogoUrl,auto:!1,onSelect:function(t){ImageInfo.SelectImageCount+=1,$("#btnUpload").show()},onUploadSuccess:function(t,e,o){var e=JSON.parse(e);"SUCCESS"!=e.state?$.alert(e.message):ImageInfo.SaveImageInfo(e.url)},onUploadError:function(t,e,o,a){"-280"!=e?$.alert("上传失败请重试。",function(){window.location.reload()}):ImageInfo.SelectImageCount-=1}}),$("#btnUpload").click(function(){return ImageInfo.CheckSelectProduct()?void $("#coverFileUploader").uploadify("upload"):void $.alert("请选择商品！")}),$("input[CbxType=AllProduct]").click(function(){"checked"==$(this).attr("checked")?$("#BasicInfoForm").find("input").attr("checked",!0):$("#BasicInfoForm").find("input").attr("checked",!1),Metronic.updateUniform()})});var ImageInfo={LogoUrl:"",ImageServer:"",ProductGroupSysNo:0,SelectImageCount:0,SelectProductSysNos:[],CheckSelectProduct:function(){return ImageInfo.SelectProductSysNos=[],$("#BasicInfoForm").find("input").each(function(){"checked"==$(this).attr("checked")&&"NormalProduct"==$(this).attr("CbxType")&&ImageInfo.SelectProductSysNos.push(parseInt($(this).val()))}),ImageInfo.SelectProductSysNos.length>0?!0:!1},SaveImageInfo:function(t){for(var e=[],o=0;o<ImageInfo.SelectProductSysNos.length;o++)e.push({ProductSysNo:ImageInfo.SelectProductSysNos[o],ResourceUrl:t});$.ajax({url:"AjaxSaveImageInfo",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(e))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||ImageInfo.ContinueUpload()},complete:function(t,e){$.hideLoading()}})},ContinueUpload:function(){ImageInfo.SelectImageCount-=1,ImageInfo.SelectImageCount>0?$("#coverFileUploader").uploadify("upload"):$.alert("上传商品图片成功！",function(){location.reload()})},UpdatePriority:function(t){var e=/^[0-9]*$/,o=$(t).val();if(0==$.trim(o).length)return $(t).val($(t).attr("OldValue")),void $.alert("请输入排序值！");if(!e.test(o))return $(t).val($(t).attr("OldValue")),void $.alert("商品图片排序顺序值只能输入正整数！");if($(t).attr("OldValue")!=o){var a={SysNo:parseInt($(t).attr("SysNo")),Priority:parseInt(o)};$.ajax({url:"AjaxUpdateProductImagePriority",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(a))},beforeSend:function(t){$.showLoading()},success:function(e){e.message||$(t).attr("OldValue",o)},complete:function(t,e){$.hideLoading()}})}},SelectAllImage:function(t){var e=parseInt($(t).attr("ProductSysNo"));"checked"==$(t).attr("checked")?$("input[SelectProduct="+e+"]").attr("checked",!0):$("input[SelectProduct="+e+"]").attr("checked",!1),Metronic.updateUniform()},BatchDelete:function(t){var e=[];e.push(ImageInfo.ProductGroupSysNo);var o=parseInt($(t).attr("ProductSysNo"));return $("input[SelectProduct="+o+"]").each(function(){"checked"==$(this).attr("checked")&&e.push(parseInt($(this).attr("SysNo")))}),1==e.length?void $.alert("请选择图片！"):void $.confirm("您确定要删除选中的图片吗？",function(t){t&&$.ajax({url:"AjaxDeleteProductImageBySysNo",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(e))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("批量删除图片成功！",function(){location.reload()})},complete:function(t,e){$.hideLoading()}})})},SetDefaultImage:function(t){var e=[],o=parseInt($(t).attr("ProductSysNo"));if($("input[SelectProduct="+o+"]").each(function(){"checked"==$(this).attr("checked")&&e.push(parseInt($(this).attr("SysNo")))}),0==e.length)return void $.alert("请选择图片！");if(e.length>1)return void $.alert("只能选择1张图片！");var a={ProductSysNo:o,SysNo:e[0]};$.confirm("您确定要将该图片设为默认图片吗？",function(t){t&&$.ajax({url:"AjaxSetProductDefaultImage",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(a))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("设置默认图片成功！",function(){location.reload()})},complete:function(t,e){$.hideLoading()}})})}};$(document).ready(function(){$("form[name=MaintainPriceForm]").bootstrapValidator({message:"输入值无效！",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{BasicPrice:{validators:{notEmpty:{message:"请输入市场价！"},regexp:{regexp:/^\d{0,8}\.{0,1}(\d{1,2})?$/,message:"市场价只能输入大于等于0的整数或者2位小数！"}}},CurrentPrice:{validators:{notEmpty:{message:"请输入销售价！"},callback:{message:"销售价只能输入大于0的整数或者2位小数！",callback:function(t,e,o){var a=/^\d{0,8}\.{0,1}(\d{1,2})?$/,n=parseFloat(t)>0&&a.test(t),r=$(o).next().next().next();return n||$(r).html("销售价只能输入大于0的整数或者2位小数！"),n}}}},VirtualPrice:{validators:{notEmpty:{message:"请输入采购价！"},regexp:{regexp:/^\d{0,8}\.{0,1}(\d{1,2})?$/,message:"采购价只能输入大于等于0的整数或者2位小数！"}}},UnitCost:{validators:{notEmpty:{message:"请输入成本价！"},regexp:{regexp:/^\d{0,8}\.{0,1}(\d{1,2})?$/,message:"成本价格只能输入大于等于0的整数或者2位小数！"}}},UnitCostWithoutTax:{validators:{notEmpty:{message:"请输入去税成本价！"},regexp:{regexp:/^\d{0,8}\.{0,1}(\d{1,2})?$/,message:"去税成本价只能输入大于等于0的整数或者2位小数！"}}},CashRebate:{validators:{notEmpty:{message:"请输入立减！"},regexp:{regexp:/^\d{0,8}\.{0,1}(\d{1,2})?$/,message:"立减只能输入大于等于0的整数或者2位小数！"}}},Point:{validators:{notEmpty:{message:"请输入增送积分！"},regexp:{regexp:/^[0-9]*$/,message:"赠送积分只能输入正整数！"}}},MaxPerOrder:{validators:{notEmpty:{message:"请输入每单限购数！"},regexp:{regexp:/^[0-9]*[1-9][0-9]*$/,message:"每单限购数只能输入正整数！"}}},MinCountPerOrder:{validators:{notEmpty:{message:"请输入最小订购数！"},regexp:{regexp:/^[0-9]*[1-9][0-9]*$/,message:"最小订购数只能输入正整数！"}}},IncrementQty:{validators:{notEmpty:{message:"请输入增量数！"},regexp:{regexp:/^\+?[1-9][0-9]*$/,message:"增量数为大于0的正整数！"}}}}}).on("success.form.bv",function(t){PriceInfo.SavePriceInfo($(this))}),$(".EditPriceInfo").click(function(){$("#MaintainPriceForm").data("bootstrapValidator").resetForm(!0),$("#ProductTitle").val($(this).attr("ProductTitle")),PriceInfo.EditPriceInfo(parseInt($(this).attr("ProductSysNo")))}),$("button[name=btnSavePriceInfo]").on("click",function(){var t=$(this).parents(".form-horizontal");t.bootstrapValidator("validate")}),$("[data-model=CurrentPrice]").change(function(){var t=$(this).attr("sysNo"),e=$("#CashRebate_"+t).val().trim(),o=$(this).val().trim();isNaN(o)||""==o||(isNaN(e)||""==e?$("#KJTCurrentPrice_"+t).val(o):$("#KJTCurrentPrice_"+t).val(parseFloat(o)+parseFloat(e)))}),$("[data-model=CashRebate]").change(function(){var t=$(this).attr("sysNo"),e=$("#CurrentPrice_"+t).val().trim(),o=$(this).val().trim();isNaN(o)||""==o||(isNaN(e)||""==e?$("#KJTCurrentPrice_"+t).val(e):$("#KJTCurrentPrice_"+t).val(parseFloat(e)+parseFloat(o)))})});var PriceInfo={EditPriceInfo:function(t){$.ajax({url:"AjaxGetProductPriceInfo?sysno="+t,type:"POST",dataType:"json",beforeSend:function(t){$.showLoading()},success:function(t){t.message||(t.KJTCurrentPrice=parseFloat(isNaN(t.CurrentPrice)?0:t.CurrentPrice)+parseFloat(isNaN(t.CashRebate)?0:t.CashRebate),$.bindEntity($("#MaintainPriceForm"),t),$("#SavePriceInfo").show())},complete:function(t,e){$.hideLoading()}})},SavePriceInfo:function(t){var e=[];return e.push($.buildEntity(t)),e[0].ProductSysNo<=0?($.alert("请选择商品！"),!1):parseFloat(e[0].CurrentPrice)<=0?($.alert("最终销售价必须大于0！"),!1):parseInt(e[0].MinCountPerOrder)>parseInt(e[0].MaxPerOrder)?($.alert("每单限购数必须大于等于最小订购数！"),!1):e[0].MinCountPerOrder%e[0].IncrementQty!=0||e[0].MinCountPerOrder/e[0].IncrementQty<1?($.alert("最小订购数 = 增量数 * N（N为大于等于1的正整数）,请修改!"),!1):(e[0].MaxPerOrder-e[0].MinCountPerOrder)%e[0].IncrementQty!=0||(e[0].MaxPerOrder-e[0].MinCountPerOrder)/e[0].IncrementQty<0?($.alert("最大订购数 = 最小订购数+增量数 * N （N为大于等于0的正整数）,请修改!"),!1):parseFloat(e[0].CurrentPrice)>=parseFloat(e[0].BasicPrice)?($.alert("最终销售价必须小于市场价, 请修改!"),!1):void $.confirm("您确定要保存价格信息吗？",function(t){t&&(e[0].IsSendPriceNotifyMail=!1,$.ajax({url:"AjaxSavePriceInfo",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(e))},beforeSend:function(t){$.showLoading()},success:function(t){t.message||$.alert("保存价格信息成功！")},complete:function(t,e){$.hideLoading()}}))})}};$(function(){$("#ProductEditModal").modal({show:!1}).on("shown.bs.modal",function(){$.ajax({type:"GET",url:"/ProductMaintain/AjaxLoadEditProduct?ProductSysNo="+ProductEdit.ProductSysNo,dataType:"html",success:function(t){$("#ProductEditModal").find(".modal-content").html(t),$(".date-picker").datepicker({dateFormat:"yyyy-mm-dd",rtl:Metronic.isRTL(),orientation:"left",autoclose:!0,language:"zh-CN"}),$(".date-range").defaultDateRangePicker(),$(".bs-select").selectpicker({iconBase:"fa",tickIcon:"fa-check"})}})}).on("hide.bs.modal",function(t){$("#ProductEditModal").find(".modal-content").html("")})});var ProductEdit={CallbackFunction:null,ProductSysNo:0,Open:function(t,e){ProductEdit.CallbackFunction=e,ProductEdit.ProductSysNo=t,$("#ProductEditModal").modal("show")},Save:function(){var t=$.buildEntity($("#MaintainForm")),e=/^[0-9]*$/,o=/^\d{0,8}\.{0,1}(\d{1,2})?$/,a="^(https://|http://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$",n=new RegExp(a);return 0==$.trim(t.ProductMode).length?($.alert("请输入型号！"),!1):0==$.trim(t.UPCCode).length?($.alert("请输入标准条形码, 如没有则填8个0！"),!1):0!=$.trim(t.Weight).length&&e.test(t.Weight)?parseInt(t.Weight)<=0?($.alert("重量必须输入大于0的整数！"),!1):o.test(t.Length)?o.test(t.Width)?o.test(t.Height)?$.trim(t.ProductOutUrl).length>0&&!n.test(t.ProductOutUrl)?($.alert("请填写正确的网址，以http://开头！"),!1):t.ShipPriceTemplateSysNo?void $.ajax({url:"/ProductMaintain/AjaxSaveSingleProductInfo",type:"POST",dataType:"json",data:{data:encodeURI(JSON.stringify(t))},beforeSend:function(t){$.showLoading()},success:function(t){t.error||$.alert("保存商品信息成功！",function(){ProductEdit.CallbackFunction?($("#ProductEditModal").modal("hide"),ProductEdit.CallbackFunction()):location.reload()})},complete:function(t,e){$.hideLoading()}}):($.alert("请选择运费模板！"),!1):($.alert("高度必须输入大于0的整数或者2位小数！"),!1):($.alert("宽度必须输入大于0的整数或者2位小数！"),!1):($.alert("长度必须输入大于0的整数或者2位小数！"),!1):($.alert("重量必须输入大于0的整数！"),!1)}},SelectCategory={SelectC3SysNo:0,SelectCategory1:function(){var t=parseInt($("#C1Select").val());if(t>0){SelectCategory.LoadCategory2(t);var e="<option value=0>"+JR("--请选择--")+"</option>";$("#C3Select").html(e)}else $("#C2Select").html("<option value=0>"+JR("--请选择--")+"</option>"),$("#C3Select").html("<option value=0>"+JR("--请选择--")+"</option>"),$("#C2Select").selectpicker("refresh"),$("#C3Select").selectpicker("refresh")},LoadCategory2:function(t){$.ajax({url:"ProductMaintain/AjaxCategory2List?sysno="+t,type:"POST",dataType:"json",beforeSend:function(t){$.showLoading()},success:function(t){if(!t.message){for(var e="<option value=0>--请选择--</option>",o=0;o<t.length;o++)e+="<option value="+t[o].SysNo+">"+t[o].CategoryName+"</option>";
$("#C2Select").html(e),$("#C2Select").selectpicker("refresh"),$("#C3Select").selectpicker("refresh")}},complete:function(t,e){$.hideLoading()}})},SelectCategory2:function(){var t=parseInt($("#C2Select").val());t>0?SelectCategory.LoadCategory3(t):($("#C3Select").html("<option value=0>"+JR("--请选择--")+"</option>"),$("#C3Select").selectpicker("refresh"))},LoadCategory3:function(t){$.ajax({url:"ProductMaintain/AjaxCategory3List?sysno="+t,type:"POST",dataType:"json",beforeSend:function(t){$.showLoading()},success:function(t){if(!t.message){for(var e="<option value=0>"+JR("--请选择--")+"</option>",o=0;o<t.length;o++)e+="<option value="+t[o].SysNo+">"+t[o].CategoryName+"</option>";$("#C3Select").html(e),$("#C3Select").selectpicker("refresh")}},complete:function(t,e){$.hideLoading()}})},SelectCategory3:function(){SelectCategory.SelectC3SysNo=parseInt($("#C3Select").val())},NextStep:function(){SelectCategory.SelectC3SysNo>0?location.href="/ProductMaintain/BasicInfo?CategorySysNo="+SelectCategory.SelectC3SysNo:$.alert(JR("请选择分类！"))}};